{% extends 'asset/index.html' %}
{% block content %}
<!-- Content Header (Page header) -->
<section class="content-header">
    <h1>
        General Form Elements
        <small>Preview</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Forms</a></li>
        <li class="active">General Elements</li>
    </ol>
</section>

<!-- Main content -->
<section class="content">
    <div class="row">
        <div class="col-md-7">
            <div class="btn-group">
                <button type="button" class="btn btn-default" id="this-year">年度</button>
                <button type="button" class="btn btn-default" id="last-month">上月</button>
                <button type="button" class="btn btn-default" id="this-month">本月</button>
            </div>
        </div>
    </div>
    <div class="row">
        <!-- left column -->
        <div class="col-md-7">
            <div class="detail-bod">
                <div id="month" style="width: 700px;height: 450px;"></div>
            </div>
        </div>
        <!--/.col (left) -->

        <!-- right column -->
        <div class="col-md-5">
            <div class="detail-bod">
                <div id="day-bar" style="width: 520px;height: 450px;"></div>
            </div>
        </div>
        <!--/.col (right) -->
    </div>
</section>
<!-- /.content -->
{% endblock %}
{% block js %}

<script src="/static/js/echarts.common.min.js"></script>
<script>
    $(document).ready(function () {
        // 基于准备好的dom，初始化echarts实例
        var MonthChart = echarts.init(document.getElementById('month'));
        $.getJSON("/dashboard/month/").done(function (data) {
            var date = [];
            var update = [];
            var add = [];

            $.each(data, function (key, value) {
                date.push(value['date']);
                update.push(value['value'][0]);
                add.push(value['value'][1]);
            });

            var option = {
                title: {
                    text: '本月数据统计'
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: ['新增统计', '更新统计',]
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                toolbox: {
                    feature: {
                        saveAsImage: {}
                    }
                },
                xAxis: {
                    type: 'category',
                    boundaryGap: false,
                    data: date
                },
                yAxis: {
                    type: 'value'
                },
                series: [
                    {
                        name: '更新统计',
                        type: 'line',
                        smooth: true,
                        data: update
                    },
                    {
                        name: '新增统计',
                        type: 'line',
                        smooth: true,
                        data: add
                    },
                ]
            };
            MonthChart.on("click", function (params) {
                console.log(params.name);
                Bar(params.name);
            });
            MonthChart.setOption(option);
        });
    });
</script>

<script>
    function Bar(date) {
        // 基于准备好的dom，初始化echarts实例
        var DayBarChart = echarts.init(document.getElementById('day-bar'));
        $.ajax({
            url: '/dashboard/month/',
            data: {date: date},
            type: 'post',
            success: function (res) {
                console.log(res.item);
                // 柱状图
                bar_option = {
                    title: {
                        text: res.date,
                        // subtext: '数据来自网络'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        }
                    },
                    legend: {
                        data: ['更新情况', '新增情况']
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'value',
                        boundaryGap: [0, 0.01]
                    },
                    yAxis: {
                        type: 'category',
                        data: res.item,
                        axisLabel: {
                            interval: 0,
                            rotate: 30
                        }
                    },
                    series: [
                        {
                            name: '新增情况',
                            type: 'bar',
                            data: res.add,

                            itemStyle: {
                                normal: {
                                    color: '#3c8dbc',
                                    lineStyle: {
                                        color: '#3c8dbc'
                                    },
                                },
                            },
                        },
                        {
                            name: '更新情况',
                            type: 'bar',
                            data: res.update,
                            itemStyle: {
                                normal: {
                                    color: '#dd4b39',
                                    lineStyle: {
                                        color: '#dd4b39'
                                    },
                                },
                            },
                        }
                    ]
                };
                DayBarChart.on("click", function (params) {
                    console.log(params.name);
                    // Bar(params.name);
                });
                DayBarChart.setOption(bar_option);
            }
        });
    }
</script>

<script>
    $(document).ready(function () {
        // 默认获取昨天数据
        Bar()
    })
</script>
<script>
    $('#this-year').click(function(){
        $.ajax({
            url:'/dashboard/month/',
            data:{period: 'year'},
            type: 'POST',
            success(res){
                console.log(res);
            },
        })
    })
</script>
{% endblock %}