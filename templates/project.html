{% extends 'index.html' %}
{% block content %}
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            爬虫管理
        </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i> 主页</a></li>
            <li><a href="#">爬虫管理</a></li>
        </ol>
    </section>

    <!-- Main content -->
    <section class="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box">
                    <div class="box-header">
                        <h3 class="box-title">Responsive Hover Table</h3>
                    </div>
                    <!-- /.box-header -->
                    <div class="box-body table-responsive no-padding">
                        <table class="table table-hover">
                            <tbody>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Reason</th>
                            </tr>
                            <tr>
                                <td>183</td>
                                <td>John Doe</td>
                                <td>11-7-2014</td>
                                <td><span class="label label-success">Approved</span></td>
                                <td>Bacon ipsum dolor sit amet salami venison chicken flank fatback doner.</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </div>
        </div>
        <!-- /.row -->
    </section>
    <!-- /.content -->
{% endblock %}
{% block js %}
    <script>
        $(document).ready(function () {
            var tbody = '<tbody>';
            $.ajax({
                url: '/api/node/',
                type: 'get',
                dataType: 'json',
                success: function (res) {
                    {#console.log(res);#}
                    $.each(res, function (k, v) {
                        var status = '';
                        if (v.status == 1) {
                            status = '<span class="label label-success">正常</span>'
                        } else {
                            status = '<span class="label label-danger">错误</span>'
                        }
                        tbody += '<tr><td>' + k + '</td>' +
                            '<td>' + status + '</td>' +
                            '<td>' + v.name + '</td>' +
                            '<td>' + v.ip + '</td>' +
                            '<td>' + v.port + '</td>' +
                            '<td>' +
                            '<button type="button" data="' + v.nid +
                            '" class="btn btn-info btn-xs" data-toggle="modal" data-target="#node-detail-model" onclick="NodeEdit(this)">编辑</button> ' +
                            '<button type="button" class="btn btn-success btn-xs" onclick="NodeDeploy(this)">配置</button>' +
                            '</td></tr>'
                    });
                    tbody += '</tbody>';
                    $('#node-list').append(tbody)
                }
            })
        })
    </script>
    <script>
        function NodeEdit(obj) {
            $.ajax({
                url: '/api/node/' + $(obj).attr("data"),
                type: 'get',
                dataType: 'json',
                success: function (res) {
                    console.log(res)
                    $("input[name='node-name-model']").val(res.name);
                    $("input[name='node-nid-model']").val(res.nid);
                    $("input[name='node-ip-model']").val(res.ip);
                    $("input[name='node-port-model']").val(res.port);
                    $("textarea[name='node-desc-model']").val(res.description);
                }
            })
        }
    </script>
    <script type="text/javascript">
        $('#node-modify').click(function () {
            var nid = $("input[name='node-nid-model']").val();
            var name = $("input[name='node-name-model']").val();
            var ip = $("input[name='node-ip-model']").val();
            var port = $("input[name='node-port-model']").val();
            var desc = $("textarea[name='node-desc-model']").val();
            $.ajax({
                url: '/api/node/' + nid,
                type: 'post',
                data: {nid: nid, name: name, ip: ip, port: port, description: desc},
                success: function (res) {
                    location.href = '/node/'
                }
            })
        });
    </script>
    <script type="text/javascript">
        $('#node-delete').click(function () {
            var nid = $("input[name='node-nid-model']").val();
            $.ajax({
                url: '/api/node/' + nid,
                type: 'delete',
                success: function (res) {
                    location.href = '/node/'
                }
            })
        });
    </script>
{% endblock %}